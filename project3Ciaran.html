<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<link href="grid12.css" rel="stylesheet">
<title> Project </title>
<script type="text/javascript">

  var numGrid = 3;

  //a 2D array of cells (elements)
  var board = new Array(numGrid);
  for(var i=0; i<numGrid; i++)
    board[i] = new Array(numGrid);

  var gameOver = false;
  var winner;

  var player1 = new User();
  var player2 = new Computer();
  player1.opponent = player2;
  player2.opponent = player1;

  var currentPlayer = player1;

  //start!
  function startGame() {
    currentPlayer.move();
  }

  
  function User() {
    this.opponent;
    this.move = function() {
      for(var i=0; i<numGrid; i++) {
        for(var j=0; j<numGrid; j++) {
          board[i][j].setAttribute('onClick','placeLetter(this)');
        }
      }
    }
  }

  function Computer() {
    this.opponent;
    this.move = function() {
      while(!gameOver) {
        var r = Math.floor(Math.random()*numGrid);
        var c = Math.floor(Math.random()*numGrid);
        if(board[r][c].innerHTML == '') {
          placeLetter(board[r][c]);
          /*
          setTimeout(function(){
            placeLetter(board[r][c]);
          },1000);*/
          break;
        }
      }
    }
  }

  /*
  Evenly divides #container into numGrid rows and numGrid columns of cells
  And store them into board for later access
  */
	function generateCells()
  {
    var container = document.getElementById('container');
    var proportion = 100/numGrid;//percentage of width or height per cell

    for(var i=0; i<numGrid; i++) {
      //create and add row
      var row = document.createElement('div');
      row.style.height = proportion + '%';
      row.className = 'row';
      container.appendChild(row);
      for(var j=0; j<numGrid; j++) {
        //create and add cell
        var cell = document.createElement('div');
        cell.className='cell';
        cell.style.position = 'relative';
        cell.style.float = 'left';
        cell.style.width = proportion + '%';
        row.appendChild(cell);
        //add this cell to board (2D array)
        board[i][j] = cell;
      }
    }
  }

  function placeLetter(element) {
    if(!gameOver){
      if(element.innerHTML != '') {
        //Clicked on a grid where there's already a letter. Doesn't do anything.
        return;
      }
      if(currentPlayer == player1) {
        //It's user's turn, place an X.
        element.className = 'cell X';
        element.style.lineHeight = container.clientHeight/numGrid + 'px';
        element.innerHTML = 'X';
      } else {
        //It's computer's turn, place an O.
        element.className = 'cell O';
        element.style.lineHeight = container.clientHeight/numGrid + 'px';
        element.innerHTML = 'O';
      }
      winner = detectWin();
      if(gameOver) console.log('Winner: ' + winner);
      currentPlayer = currentPlayer.opponent;
      currentPlayer.move();
    }
  }

  /*
  return 'X' if X wins, or return 'O' if O wins. 
  return 'tie' if the whole board is filled but nobody wins.
  Otherwise doesn't change or return anything.
  */
  function detectWin() {
    var letterCount = 0;
    var Xhori = 0; var Ohori = 0;
    var Xvert = 0; var Overt = 0;
    var Xdiag1 = 0; var Odiag1 = 0;
    var Xdiag2 = 0; var Odiag2 = 0;
    for(var i=0; i<numGrid; i++) {
      //diagonals
      if(board[i][i].innerHTML == 'X') Xdiag1++;
      else if(board[i][i].innerHTML == 'O')Odiag1++;
      if(board[i][numGrid-1-i].innerHTML == 'X') Xdiag2++;
      else if(board[i][numGrid-i-1].innerHTML == 'O')Odiag2++;

      for (var j=0; j<numGrid; j++) {
        if(board[i][j].innerHTML != '') {
          //count towards checking if the whole board is filled.
          letterCount++;
          //horizontal
          if(board[i][j].innerHTML == 'X') Xhori++;
          else if(board[i][j].innerHTML == 'O')Ohori++;
        }
        //vertical
        if(board[j][i].innerHTML == 'X') Xvert++;
        else if(board[j][i].innerHTML == 'O')Overt++;
      }
      //any horizantal or vertical win, after running this inner loop?
      if(Xhori == numGrid || Xvert == numGrid) {gameOver = true; return 'X';}
      else if(Ohori == numGrid || Overt == numGrid) {gameOver = true; return 'O';}
      //reset horizontal and vertical count variables
      else {Xhori = 0; Ohori = 0; Xvert = 0; Overt = 0;}
    }
    //any diagonal win, after completing the outer loop?
    if(Xdiag1 == numGrid || Xdiag2 == numGrid) {gameOver = true; return 'X';}
    else if(Odiag1 == numGrid || Odiag2 == numGrid) {gameOver = true; return 'O';}
    //is the whole board filled?
    else if(letterCount == numGrid**2) {gameOver = true; return 'tie';}
  }

</script>
<style>
  *{
    margin:0;
    padding:0;
  }

  div.cell{
    margin:0;
    padding:0;
    height:100%;
    border:2px solid black;
  }
  div.cell:hover{
    background-color: #ffffcc;
  }

  .X,.O{
    width:100%;
    height:100%;
    font-size:72px;
    text-align:center;
    vertical-align:middle;
  }
  #container{
    width:800px;
    height:600px;
  }
  #title{
    text-align:center;
  }

</style>
</head>
<body onload="generateCells(); startGame();">
  <div class="container">
    <h3 id="title">A placeholder title</h3>
    <div id="container" class="container-fluid"></div>
  </div>
</body>
</html>